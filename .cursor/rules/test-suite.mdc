---
alwaysApply: true
description: "Test suite and integration testing guidelines for dtolator project"
---

# Test Suite Documentation

## Overview

The dtolator project uses a comprehensive Rust-based integration test suite (`tests/integration_tests.rs`) to verify that code generation works correctly across all supported output formats. The test suite compares generated output against expected sample files in `output-samples/`.

## Running the Test Suite

### Basic Usage

```bash
python run-tests.py              # Build and run all tests
python run-tests.py --refresh    # Regenerate expected output files
python run-tests.py --help       # Show help information
```

### Common Scenarios

**Run tests after code changes (with full build):**
```bash
python run-tests.py
```

**Update expected outputs after intentional improvements:**
```bash
python run-tests.py --refresh
```

**View available options:**
```bash
python run-tests.py --help
```

## Understanding Test Output

### Success
All 22 tests pass and display:
```
Total tests: 22
Passed: 22
Failed: 0

ALL TESTS PASSED!
```

### Failures
If tests fail, review the diff output to understand what changed:
```
ERROR: Output differs from expected
   File differs: schema.ts
   Diff for schema.ts:
-  old_line
+  new_line
```

## When to Refresh Test Outputs

**DO refresh outputs when:**
- Intentionally improving code generation (e.g., using regex literals instead of `new RegExp()`)
- Fixing bugs that affect generated code format
- Adding new features that improve output quality

**DO NOT refresh outputs when:**
- Tests fail due to regressions or bugs - fix the underlying code instead
- Unrelated files changed - investigate why tests are affected

## Test Coverage

The suite covers 22 test cases across:
- **Angular**: Services with/without Zod validation, promises support
- **TypeScript**: Interfaces and type definitions
- **Zod**: Schema validation
- **Pydantic**: Python models
- **Python TypedDict**: Typed dictionary definitions
- **C#/.NET**: Classes with System.Text.Json
- **JSON Schema**: Generation and conversion from various inputs

Each test case:
1. Runs dtolator with specific flags
2. Generates output to a temporary directory
3. Compares with expected files in `output-samples/`
4. Reports success or detailed diff on failure

## Output Samples Directory

The `output-samples/` directory contains expected outputs organized by test type:

```
output-samples/
├── angular/
│   ├── full-sample/
│   └── simple-sample/
├── nested-test/
├── pydantic/
├── dotnet/
├── json-simple-zod/
└── ... (other output types)
```

After running `--refresh`, all expected files are updated to match current dtolator output.

## Implementation Details

The test suite is implemented in Rust with a Python wrapper:
- `tests/integration_tests.rs` - Main test harness
- Environment variable `DTOLATOR_TEST_REFRESH` - Controls refresh mode
- `run-tests.py` - Python wrapper script

Each test runs dtolator with specific generator flags and compares the output against expected files in `output-samples/`.

## Integration with Development

After making code changes:
1. Run tests: `python run-tests.py`
2. If tests fail with intentional improvements, review the diff
3. If the change is correct, refresh: `python run-tests.py --refresh`
4. Commit both code changes and updated test outputs
